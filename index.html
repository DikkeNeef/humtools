<!DOCTYPE html>
<!--[if lte IE 6]><html class="preIE7 preIE8 preIE9"><![endif]-->
<!--[if IE 7]><html class="preIE8 preIE9"><![endif]-->
<!--[if IE 8]><html class="preIE9"><![endif]-->
<!--[if gte IE 9]><!-->
<html>
<!--<![endif]-->

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Humongous Editor</title>
    <meta name="author" content="Dikke Neef">
    <meta name="description" content="Humongous Web Tools">
    <meta name="keywords" content="Humongous,Editor,Core,Python,Brython">
    <link rel="shortcut icon" href="favicon.ico" type="image/vnd.microsoft.icon">
    <link rel="stylesheet" href="dist/ui.min.css" />
    <link rel="stylesheet" href="dist/ui-jennifer.min.css" />
    <script src="lib/jquery-1.8.0.min.js"></script>
    <script src="lib/core.min.js"></script>
    <script src="dist/ui.min.js"></script>
    <script>
        var findElementByAttribute = function(a, value) {
            for (var i = 0, len = a.length; i < len; i++) {
                if (a[i].getAttribute("data-key") === value) {
                    return a[i];
                }
            }
            return null;
        }
        var disableElementByAttribute = function(e, value) {
            for (var i = 0, len = e.length; i < len; i++) {
                console.log(e[i].getAttribute("data-key"));
                if (e[i].getAttribute("data-key") === value) {
                    return e[i].getElementsByTagName("input")[0].setAttribute("disabled", "disabled");
                }
            }
            return null;
        }
        jui.ready(["ui.accordion"], function(accordion) {
            accordion = accordion("#accordion", {
                multipanel: true,
                event: {
                    init: function() {
                        console.log('accordian initialized.');
                    },
                    open: function(index, e) {
                        $(this.root).find("i").attr("class", "icon-arrow1");
                        $(e.target).find("i").attr("class", "icon-arrow3");
                    },
                    fold: function(index, e) {
                        $(e.target).find("i").attr("class", "icon-arrow1");
                    }
                },
                index: 1,
                autoFold: true
            });
            var content = $("div.content");
            content.css("height", "" + innerHeight - (content.length + 1) * 34 + "px");
        });

        function guid4() {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                var r = Math.random() * 16 | 0,
                    v = c == 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        }

        function intray(m) {
            var a = [];
            for (var i = 0; i < m; i++) {
                a.push(i);
            }
            return a
        }

        function int2strray(m) {
            var a = [];
            for (var i = 0; i < m; i++) {
                a.push('' + i);
            }
            return a
        }

        var d = [{
                type: 'group',
                title: 'General',
            },
            {
                type: 'text',
                title: 'Name',
                key: 'name',
                value: '',
                description: ''
            },
            {
                type: 'text',
                title: 'GUID',
                key: 'guid',
                value: ' ',
                description: ''
            },
            {
                type: 'select',
                title: 'Scene',
                key: 'scene',
                value: '0',
                items: int2strray(8)
            },
            {
                type: 'group',
                title: 'Advanced'
            },
            {
                type: 'switch',
                title: 'Loop',
                key: 'loop',
                value: false,
                description: ''
            },
            {
                type: 'text',
                title: 'Sound',
                key: 'sound',
                value: '',
                description: 'IF EMPTY it uses the GUID as name'
            },
            {
                type: 'select',
                title: 'Script',
                key: 'script',
                value: '',
                items: ['normal', 'choice', 'sequence', 'disable animation']
            },
            {
                type: 'html',
                title: 'Script Parameters',
                key: 'parameters',
                value: '',
                description: '',
                vertical: false
            },
            {
                type: 'group',
                title: 'Complex'
            },
            {
                type: 'switch',
                title: 'Singleton',
                key: 'singleton',
                value: false,
                description: 'Turns down ALL animations and sounds except this'
            },
            {
                type: 'switch',
                title: 'Block',
                key: 'block',
                value: false,
                description: 'Blocks further interaction (e.g. leaving scene)'
            },
            {
                type: 'html',
                title: 'Stop',
                key: 'stop',
                value: '',
                description: 'Turns down animations and sounds (can self-include)',
                vertical: false
            },
            {
                type: 'switch',
                title: 'Blacklist',
                key: 'blacklist',
                value: false,
                description: 'Ignore this animation while slicing other animations'
            }
        ]

        var mts_configuration = function(_d, first_config) {
            var first_config = first_config || false;
            var e = document.getElementById("mts-pr-settings");
            if (e !== null) {
                e.innerHTML = ""
            }
            jui.ready(["ui.property"], function(PropertyView) {
                window.mts_property_settings = new PropertyView('#mts-pr-settings', {
                    items: _d
                });

                var e = document.getElementById("mts-pr-settings");
                if (e !== null) {
                    disableElementByAttribute(document.getElementsByClassName("property-item"), "guid");
                    if (first_config == true) {
                        disableElementByAttribute(document.getElementsByClassName("property-item"), "name");
                    }
                }
            });

        }
        mts_configuration(d);

        jui.ready(["ui.tree"], function(tree) {
            object_tree = tree("#object_tree .tree", {
                root: {
                    title: "scene"
                },
                event: {
                    select: function(node) {
                        this.select(node.index);
                        try {
                            if (~node.index.indexOf(".")) {
                                console.log('' + node.index.split('.')[0] + ' -> ' + node.data.title);
                            }
                        } catch (e) {}
                    }
                },
                tpl: {
                    node: $("#tpl_node").html()
                }
            });
            var scenes = 8;
            for (var i = 0; i < scenes; i++) {

                object_tree.append({
                    title: "" + i
                });

                object_tree.append("" + i, {
                    title: guid4() + " ::: " + "Pajama Sam"
                });

                object_tree.append("" + i, {
                    title: guid4() + " ::: " + "Spy Fox"
                });
            }
            for (var i = 0; i < scenes; i++) {

                object_tree.fold("" + i)
            }
        });

        jui.ready(["ui.tree"], function(tree) {
            object_tree = tree("#scene_tree .tree", {
                root: {
                    title: "scene"
                },
                event: {
                    select: function(node) {
                        this.select(node.index);
                        try {
                            if (~node.index.indexOf(".")) {
                                console.log('' + node.index.split('.')[0] + ' -> ' + node.data.title);
                            }
                        } catch (e) {}
                    }
                },
                tpl: {
                    node: $("#tpl_node").html()
                }
            });
            var scenes = 8;
            for (var i = 0; i < scenes; i++) {

                object_tree.append({
                    title: "" + i
                });

                object_tree.append("" + i, {
                    title: "Image"
                });

                object_tree.append("" + i, {
                    title: "Music"
                });
            }
            for (var i = 0; i < scenes; i++) {

                object_tree.fold("" + i)
            }
        });


        jui.ready(["ui.tree"], function(tree) {
            object_tree = tree("#conv_tree .tree", {
                root: {
                    title: "scene"
                },
                event: {
                    select: function(node) {
                        this.select(node.index);
                        try {
                            if (~node.index.indexOf(".")) {
                                console.log('' + node.index.split('.')[0] + ' -> ' + node.data.title);
                            }
                        } catch (e) {}
                    }
                },
                tpl: {
                    node: $("#tpl_node").html()
                }
            });
            var scenes = 8;
            for (var i = 0; i < scenes; i++) {

                object_tree.append({
                    title: "" + i
                });

                object_tree.append("" + i, {
                    title: guid4() + " ::: " + "Melon 1"
                });

                object_tree.append("" + i, {
                    title: guid4() + " ::: " + "Melon 2"
                });
            }
            for (var i = 0; i < scenes; i++) {

                object_tree.fold("" + i)
            }
        });

    </script>

    <script id="tpl_node" type="text/template">
        <li>
            <div style="font-family: Consolas, monaco, monospace; font-size: 16px;">
                <!= title !>
            </div>
            <ul></ul>
        </li>
    </script>
    <style type="text/css">
        .hover {
            background: #FFF !important;
            color: #000 !important;
        }
        
        .hover:hover {
            cursor: pointer !important;
            background: #000 !important;
            color: #FFF !important;
        }
        
        .hover:hover {
            cursor: pointer !important;
            background: #000 !important;
            color: #FFF !important;
        }
        
        .hover:active {
            cursor: pointer !important;
            box-shadow: 2px 2px -2px -2px #222;
            transform: translateY(-2px);
        }
        
        .mts-property-container {
            float: left;
            width: 40%;
            height: 640px;
            position: relative;
            overflow: auto;
            border: 1px solid #000;
        }
        
        .mts-property-container h1 {
            color: #000;
            text-align: center;
            margin-top: 10px;
            margin-bottom: 10px;
            border-bottom: 0px;
        }
        
        .mts-tree-container {
            float: right;
            width: 57.5%;
            height: 640px;
            position: relative;
            overflow: auto;
            border: 1px solid #000;
        }
        
        .mts-tree-container h1 {
            color: #000;
            text-align: center;
            margin-top: 10px;
            margin-bottom: 10px;
            border-bottom: 0px;
        }

    </style>
</head>

<body class="jui" style="margin: 0px; background-color: #FFFFFF; overflow:hidden;">
    <div id="accordion" class="accordion" style="margin-top: -4px; border-radius: 0px; border-style: hidden;">
        <div class="title">
            Player <i class="icon-arrow3"></i>
        </div>
        <div class="content" style="display: flex; justify-content: center; align-items: center; ">
            <div style="text-align: center;">
                <div class="btn h2" style="margin: 0 auto; text-align:center; background-color:black; color: white; background-image: none; border-radius: 0; border: 0px solid;"> run </div>
                <canvas style="border: #000000 solid 2px; background-color: #FFFFFF;" width="640px" height="480px"></canvas>
            </div>
        </div>


        <div class="title">
            All-Around Object Editor <i class="icon-arrow1"></i>
        </div>
        <div class="content">
            <div class="col col-4">
                <div style="text-align: center;">
                    <ul class="pill top">
                        <li class="active">
                            <a href="#" class="hover">Load</a>
                        </li>

                        <li class="active">
                            <a href="#" class="hover">Reset</a>
                        </li>

                        <li class="active">
                            <a href="#" class="hover">Slice</a>
                        </li>
                        <li class="active">
                            <a class="hover" href="#">Blacklist Slice</a>
                        </li>
                        <li class="active">
                            <input id="seconds" type="number" max="100" min="0" step="1" value="10" style="text-align: center; margin-top:4px;">
                            <div style="text-align: center; margin-left:8px;padding-top:4px; float:right; font-size:16px;"> seconds for slicing</div>
                        </li>
                    </ul>
                    <div class="row">
                        <div style="text-align: center;" width="640px" height="480px">
                            <canvas id="canvas" style="border: #000000 solid 2px; " width="640px " height="480px "></canvas>
                            <script>
                                var canvas = document.getElementById('canvas'),
                                    ctx = canvas.getContext('2d'),
                                    rect = {},
                                    drag = false;

                                function clear() {
                                    ctx.clearRect(0, 0, 640, 480);
                                }

                                function draw() {
                                    ctx.beginPath();
                                    ctx.rect(rect._X, rect._Y, rect.w, rect.h);
                                    ctx.stroke();

                                    ctx.moveTo(rect.x - rect.w / 2.0, rect.y);
                                    ctx.lineTo(rect.x - rect.w / 2.0, rect.y - rect.h);
                                    ctx.stroke();

                                    ctx.moveTo(rect.x, rect.y - rect.h / 2.0);
                                    ctx.lineTo(rect.x - rect.w, rect.y - rect.h / 2.0);
                                    ctx.stroke();
                                }

                                function getOffset(el) {
                                    var _x = 0;
                                    var _y = 0;
                                    while (el && !isNaN(el.offsetLeft) && !isNaN(el.offsetTop)) {
                                        _x += el.offsetLeft - el.scrollLeft;
                                        _y += el.offsetTop - el.scrollTop;
                                        el = el.offsetParent;
                                    }
                                    return {
                                        top: _y,
                                        left: _x
                                    };
                                }

                                function mouseDown(e) {
                                    offset = getOffset(canvas);
                                    rect._X = e.pageX - offset.left;
                                    rect._Y = e.pageY - offset.top;
                                    rect.x = e.pageX - offset.left;
                                    rect.y = e.pageY - offset.top;
                                    drag = true;
                                }

                                function mouseUp() {
                                    drag = false;
                                    console.log(get_coords());
                                }

                                function get_coords() {
                                    if (rect.h < 0) {
                                        rect._Y += rect.h;
                                        rect.h *= -1;
                                    }
                                    if (rect.w < 0) {
                                        rect._X += rect.w;
                                        rect.w *= -1;
                                    }
                                    return {
                                        x: rect._X,
                                        y: rect._Y,
                                        w: rect.w,
                                        h: rect.h
                                    };
                                }

                                function mouseMove(e) {
                                    if (drag) {
                                        rect.x = e.pageX - offset.left;
                                        rect.y = e.pageY - offset.top;
                                        rect.w = e.pageX - rect._X - offset.left;
                                        rect.h = e.pageY - rect._Y - offset.top;
                                        clear();
                                        draw();
                                    }
                                }

                                function init() {
                                    canvas.addEventListener('mousedown', mouseDown, false);
                                    canvas.addEventListener('mouseup', mouseUp, false);
                                    canvas.addEventListener('mousemove', mouseMove, false);
                                }

                                init();

                            </script>
                        </div>
                        <br>
                        <div id="slider_mts" class="slider" width="640px" height="32px"></div>
                    </div>
                </div>
            </div>
            <div class="col col-1">
            </div>
            <div class="col col-7">
                <ul class="pill top">

                    <li class="active">
                        <a href="#">Initial Customization of Properties</a>
                        <div class="anchor"></div>
                    </li>

                    <li class="active">
                        <a href="#" class="hover">Save Properties</a>
                    </li>

                    <li class="active">
                        <a href="#" class="hover">Listen to Audio</a>

                    </li>
                    <audio id="audio_object" type="audio/ogg" controls style="width: 320px; height: 32px;" />

                </ul>
                <div class="row">
                    <div class="mts-property-container">
                        <h1>Object Properties</h1>
                        <hr>
                        <div id="mts-pr-settings" class="property"></div>
                    </div>
                    <div class="mts-tree-container">
                        <h1>Object Tree</h1>
                        <hr>
                        <div id="object_tree" class="row">
                            <div class="col col-12">
                                <ul class="tree line"></ul>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <div class="title ">
            Scene Editor <i class="icon-arrow1 "></i>
        </div>
        <div class="content ">
            <div class="col col-4">
                <div style="text-align: center;">
                    <ul class="pill top">

                        <li class="active">
                            <a href="#" class="hover">Capture Background</a>
                        </li>

                        <li class="active">
                            <a href="#" class="hover">Record Music</a>
                        </li>

                    </ul>
                    <div class="row">
                        <div style="text-align: center;" width="640px" height="480px">
                            <canvas id="scene_preview" style="border: #000000 solid 2px; " width="640px " height="480px "></canvas>
                        </div>
                        <br>
                        <audio id="audio_scene" type="audio/ogg" controls style="width: 640px; height: 48px;" />
                    </div>
                </div>
            </div>
            <div class="col col-1">
            </div>
            <div class="col col-7">
                <ul class="pill top">

                    <li class="active">
                        <a href="#">Initial Customization of Scenes</a>
                        <div class="anchor"></div>
                    </li>

                    <li class="active">
                        <a href="#" class="hover">Add Scene</a>
                    </li>

                    <li class="active">
                        <a href="#" class="hover">Save Scene</a>
                    </li>

                </ul>
                <div class="row">
                    <div class="mts-tree-container" style="height: 480px; float: left; width:100%;">
                        <h1>Scene Tree</h1>
                        <hr>
                        <div id="scene_tree" class="row">
                            <div class="col col-12">
                                <ul class="tree line"></ul>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <div class="title ">
            Conversation Editor <i class="icon-arrow1 "></i>
        </div>
        <div class="content ">

            <div class="col col-7">
                <div style="text-align: center;">
                    <ul class="pill top">

                        <li class="active">
                            <a href="#" class="hover">Save</a>
                        </li>

                    </ul>
                </div>
                <div class="row" style="border: 2px solid #000">
                    <div style="text-align:center; font-size:22px; margin-bottom:8px; margin-top:8px;">Time: start, stop</div>
                    <textarea style="width:99%; height:120px; resize:none; margin-left:2px;"></textarea>
                </div>
                <div class="row" style="border: 2px solid #000">
                    <div style="text-align:center; font-size:22px; margin-bottom:8px; margin-top:8px;">Dutch</div>
                    <textarea style="width:99%; height:120px; resize:none; margin-left:2px;"></textarea>
                </div>
                <br>
                <div class="row" style="border: 2px solid #000">
                    <div style="text-align:center; font-size:22px; margin-bottom:8px; margin-top:8px;">English</div>
                    <textarea style="width:99%; height:120px; resize:none; margin-left:2px;"></textarea>
                </div>
                <br>
                <div class="row" style="border: 2px solid #000">
                    <div style="text-align:center; font-size:22px; margin-bottom:8px; margin-top:8px;">French</div>
                    <textarea style="width:99%; height:120px; resize:none; margin-left:2px;"></textarea>
                </div>
                <br>
            </div>
            <div class="col col-1">
            </div>
            <div class="col col-4">
                <ul class="pill top">

                    <li class="active">
                        <a href="#">Initial Customization of Conversations - subtitles</a>
                        <div class="anchor"></div>
                    </li>

                </ul>
                <div class="row">
                    <div class="mts-tree-container" style="height: 480px; float: left; width:100%;">
                        <h1>Conversation Tree</h1>
                        <hr>
                        <div id="conv_tree" class="row">
                            <div class="col col-12">
                                <ul class="tree line"></ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
    <script>
        jui.ready(["ui.slider"], function(slider) {
            slider("#slider_mts ", {
                type: "double",
                from: 0,
                to: 100000,
                min: 0,
                max: 100000,
                step: 1,
                tooltip: false,
            });
        });

    </script>
</body>

</html>
